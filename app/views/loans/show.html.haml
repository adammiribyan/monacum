- title t("monacum.loans.show.title")

= render "/clients/header"

.page_contents_wrapper.clear.no-padding
	.page_main_column.column
		.liner
			%span.back-to-client
				←
				= link_to "Вернуться к списку займов", @client
			%h1 Информация о займе
			%ul.loan-data-table
				%li{:class => cycle("even", "odd")}
					%strong Выдала:
					= link_to "Огурцова Наталья", ""
				%li{:class => cycle("even", "odd")}
					%strong Филиал:
					= link_to "ул. Победы, 86", ""
				%li{:class => cycle("even", "odd")}
					%strong Дата выдачи:
					%span{:style => "color: #{loan_type(@loan)}"}= I18n.l @loan.created_at.to_date
				%li{:class => cycle("even", "odd")} 
					%strong Сумма:
					= number_to_currency @loan.amount
				%li{:class => cycle("even", "odd")}
					%strong Срок:
					= "#{number_to_date @loan.term} (до #{I18n.l((@loan.created_at + @loan.term.to_i.days).to_date)})"
			- unless @loan.is_repaid?
				.button-group.bottom-offset-20.top-offset-20
					.new-button.button-disabled.fr#new_loan-button
						%a{:href => ""}
							%span.bg
								%span.l
								%span.r
								%span.icon								
								%span.text погасить займ				
			
			.additional-info
				.block.interest
					%h1 Проценты
					%ul.loan-data-table
						%li{:class => cycle("even", "odd")} 
							%strong Начисляются уже:
							= distance_of_time_in_words(Date.today, @loan.created_at.to_date)
						%li{:class => cycle("even", "odd")} 
							%strong Сумма на сегодняшний день:
							= number_to_currency interest(Date.today, @loan.created_at, @loan.amount)
						
				.block.payments					
					%h1 Выплаты						
					%table.loan-payments
						%tbody
							= render @loan.payments
									
					.button-group.bottom-offset-20.top-offset-20
						.fr
							= buttoned_link_to "Добавить выплату", new_loan_payment_path(@loan)
					.clear
				.block.summary
					%span	
						Итого выплачено:
						%strong= number_to_currency(@loan.payments.sum("amount"))
					%span 
						Осталось выплатить с процентами:
						%strong= number_to_currency(left_to_pay_with_interest(@loan))
			